<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Article - ThoughtHive</title>
<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background: url('https://images.unsplash.com/photo-1499084732479-de2c02d45fc4?auto=format&fit=crop&w=1400&q=80') no-repeat center center fixed;
  background-size: cover;
  color:#fff;
  display:flex;
  flex-direction:column;
  min-height:100vh;
}
.page-container{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding:20px;
  backdrop-filter:blur(12px);
}
.article-box{
  background:rgba(0,0,0,0.75);
  padding:25px;
  border-radius:20px;
  width:100%;
  max-width:700px;
  display:flex;
  flex-direction:column;
  gap:15px;
}
h1,h2{margin:0;}
button.back-btn{
  background:#ff4d4d;
  color:white;
  border:none;
  border-radius:12px;
  padding:10px 15px;
  cursor:pointer;
  font-size:1em;
  align-self:flex-end;
}
.comment-box{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.comment-item{
  background:rgba(255,255,255,0.1);
  padding:10px;
  border-radius:10px;
  word-wrap:break-word;
}
input,textarea{width:100%;padding:10px;border-radius:10px;border:none;background: rgba(255,255,255,0.1);color:#fff;}
button.submit-comment{background:#007bff;color:white;border:none;padding:10px;border-radius:10px;cursor:pointer;}
button.submit-comment:hover{background:#0056b3;}
</style>
</head>
<body>

<div class="page-container">
  <div class="article-box" id="article-box">
    <button class="back-btn" onclick="window.location.href='index.html'">✖ Back</button>
    <h1 id="article-title"></h1>
    <p id="article-category"></p>
    <p id="article-content"></p>
    <p><strong>Author:</strong> <span id="article-author"></span></p>
    <hr style="border-color:rgba(255,255,255,0.3)">
    <h3>Comments</h3>
    <div class="comment-box" id="comments"></div>
    <input type="text" id="commenter" placeholder="Your Name">
    <textarea id="comment-text" placeholder="Write comment..." rows="3"></textarea>
    <button class="submit-comment" onclick="postComment()">Post Comment</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAQ4oeDRpMPkpxtcxq-xe7qRwUfIrhUztw",
  authDomain: "thoughthive-ebf0d.firebaseapp.com",
  projectId: "thoughthive-ebf0d",
  storageBucket: "thoughthive-ebf0d.firebasestorage.app",
  messagingSenderId: "254009291887",
  appId: "1:254009291887:web:b5ce7301fb673ba257499a",
  measurementId: "G-5C2Q4SDZ3Y"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const urlParams = new URLSearchParams(window.location.search);
const articleId = urlParams.get('id');
const articleBox = document.getElementById('article-box');
const titleEl = document.getElementById('article-title');
const contentEl = document.getElementById('article-content');
const authorEl = document.getElementById('article-author');
const categoryEl = document.getElementById('article-category');
const commentsDiv = document.getElementById('comments');

let commentsData=[];

// Load article
db.collection('articles').doc(articleId).get().then(doc=>{
  if(doc.exists){
    const data = doc.data();
    titleEl.textContent = data.title;
    contentEl.textContent = data.content;
    authorEl.textContent = data.author;
    categoryEl.textContent = "Category: " + (data.category || 'General');
  }
});

// Load comments
db.collection('articles').doc(articleId).collection('comments').orderBy('timestamp','asc')
.onSnapshot(snapshot=>{
  commentsData=[];
  snapshot.forEach(doc=>{
    commentsData.push({id:doc.id,...doc.data()});
  });
  renderComments();
});

function renderComments(){
  commentsDiv.innerHTML='';
  commentsData.forEach(c=>{
    const div=document.createElement('div');
    div.className='comment-item';
    div.innerHTML=`<strong>${c.name}:</strong> ${c.text} <button style="float:right;background:red;color:white;border:none;border-radius:5px;cursor:pointer;" onclick="deleteComment('${c.id}')">✖</button>`;
    commentsDiv.appendChild(div);
  });
}

function postComment(){
  const name=document.getElementById('commenter').value.trim();
  const text=document.getElementById('comment-text').value.trim();
  if(!name||!text){alert('Fill both fields!'); return;}
  db.collection('articles').doc(articleId).collection('comments').add({
    name,text,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById('commenter').value='';
  document.getElementById('comment-text').value='';
}

function deleteComment(id){
  if(confirm('Delete this comment?')){
    db.collection('articles').doc(articleId).collection('comments').doc(id).delete();
  }
}
</script>
</body>
</html>
